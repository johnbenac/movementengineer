<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Movement Engineer v3</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link rel="stylesheet" href="./styles.css" />
</head>
<body>
  <header class="top-bar">
    <div class="top-bar-left">
      <h1>Movement Engineer v3</h1>
      <span class="schema-version">Schema v3.4</span>
    </div>
    <div class="top-bar-right">
      <button id="btn-new-snapshot" title="Clear everything and start from an empty dataset">
        New snapshot
      </button>
      <button id="btn-load-sample" title="Load the bundled Catholic example dataset">
        Load sample
      </button>
      <button id="btn-export-snapshot" title="Download current snapshot as JSON">
        Export JSON
      </button>
      <button id="btn-import-snapshot" title="Load a snapshot JSON from disk">
        Import JSON
      </button>
      <input id="file-input" type="file" accept="application/json" hidden />
      <span id="status" class="status"></span>
    </div>
  </header>

  <main class="layout">
    <aside class="sidebar">
      <div class="sidebar-header">
        <h2>Movements</h2>
        <button id="btn-add-movement" title="Create a new movement">+</button>
      </div>
      <ul id="movement-list" class="item-list"></ul>
    </aside>

    <section class="content">
      <nav class="tabs">
        <button class="tab active" data-tab="dashboard">Dashboard</button>
        <button class="tab" data-tab="movement">Movement</button>
        <button class="tab" data-tab="data">Collections</button>
        <button class="tab" data-tab="comparison">Comparison</button>
      </nav>

      <!-- Dashboard tab -->
      <section id="tab-dashboard" class="tab-panel active">
        <div id="dashboard-content" class="panel-body"></div>
      </section>

      <!-- Single movement details + explorer -->
      <section id="tab-movement" class="tab-panel">
        <div class="panel-body">
          <h2>Movement details</h2>
          <p class="hint">
            Choose a movement in the sidebar, then edit its core fields here.
          </p>
          <form id="movement-form" autocomplete="off">
            <div class="form-row">
              <label>ID</label>
              <span id="movement-id-label" class="code-pill">—</span>
            </div>

            <div class="form-row">
              <label for="movement-name">Name</label>
              <input id="movement-name" type="text" required />
            </div>

            <div class="form-row">
              <label for="movement-shortName">Short name</label>
              <input id="movement-shortName" type="text" />
            </div>

            <div class="form-row">
              <label for="movement-summary">Summary</label>
              <textarea id="movement-summary" rows="4"></textarea>
            </div>

            <div class="form-row">
              <label for="movement-tags">Tags (comma‑separated)</label>
              <input id="movement-tags" type="text" placeholder="test, catholic, etc." />
            </div>

            <div class="form-actions">
              <button id="btn-save-movement" type="button">Save movement</button>
              <button id="btn-delete-movement" type="button" class="danger">
                Delete movement & related data
              </button>
            </div>
          </form>

          <hr class="section-divider" />

          <div class="movement-explorer">
            <h3>Explore this movement</h3>
            <p class="hint">
              Read‑only explorers driven by the view‑model builders. Switch sections to browse
              texts, entities, practices, calendar, claims, rules, authority, media, relations and notes.
            </p>

            <div class="subtabs" id="movement-subtabs">
              <button class="subtab active" data-subtab="scripture">Scripture</button>
              <button class="subtab" data-subtab="entities">Entities</button>
              <button class="subtab" data-subtab="practices">Practices</button>
              <button class="subtab" data-subtab="calendar">Calendar</button>
              <button class="subtab" data-subtab="claims">Claims</button>
              <button class="subtab" data-subtab="rules">Rules</button>
              <button class="subtab" data-subtab="authority">Authority</button>
              <button class="subtab" data-subtab="media">Media</button>
              <button class="subtab" data-subtab="relations">Relations</button>
              <button class="subtab" data-subtab="notes">Notes</button>
            </div>

            <!-- Scripture -->
            <section id="movement-subtab-scripture" class="subtab-panel active">
              <div class="subtab-toolbar">
                <label>
                  Text collection:
                  <select id="scripture-collection-select"></select>
                </label>
              </div>
              <div id="scripture-tree" class="tree-container"></div>
            </section>

            <!-- Entities -->
            <section id="movement-subtab-entities" class="subtab-panel">
              <div class="subtab-toolbar">
                <label>
                  Entity:
                  <select id="entity-select"></select>
                </label>
              </div>
              <div id="entity-detail" class="detail-section"></div>

              <div class="section-heading small">Relation graph (list view)</div>
              <div class="subtab-toolbar">
                <label>
                  Depth:
                  <select id="entity-graph-depth">
                    <option value="1">1</option>
                    <option value="2">2</option>
                    <option value="3">3</option>
                  </select>
                </label>
                <label class="grow">
                  Relation types (comma‑separated, optional):
                  <input
                    id="entity-graph-relation-types"
                    type="text"
                    placeholder="mother_of, part_of, instance_of"
                  />
                </label>
                <button id="btn-refresh-entity-graph" type="button">Refresh graph</button>
              </div>
              <div id="entity-graph" class="detail-section"></div>
            </section>

            <!-- Practices -->
            <section id="movement-subtab-practices" class="subtab-panel">
              <div class="subtab-toolbar">
                <label>
                  Practice:
                  <select id="practice-select"></select>
                </label>
              </div>
              <div id="practice-detail" class="detail-section"></div>
            </section>

            <!-- Calendar -->
            <section id="movement-subtab-calendar" class="subtab-panel">
              <div class="subtab-toolbar">
                <label>
                  Recurrence:
                  <select id="calendar-recurrence-filter">
                    <option value="">All</option>
                    <option value="once">once</option>
                    <option value="daily">daily</option>
                    <option value="weekly">weekly</option>
                    <option value="monthly">monthly</option>
                    <option value="yearly">yearly</option>
                    <option value="other">other</option>
                  </select>
                </label>
              </div>
              <div id="calendar-view" class="card-grid"></div>
            </section>

            <!-- Claims -->
            <section id="movement-subtab-claims" class="subtab-panel">
              <div class="subtab-toolbar">
                <label>
                  Category:
                  <select id="claims-category-filter">
                    <option value="">All</option>
                  </select>
                </label>
                <label>
                  About entity:
                  <select id="claims-entity-filter">
                    <option value="">Any</option>
                  </select>
                </label>
              </div>
              <div id="claims-table-wrapper" class="table-wrapper"></div>
            </section>

            <!-- Rules -->
            <section id="movement-subtab-rules" class="subtab-panel">
              <div class="subtab-toolbar">
                <label>
                  Kind:
                  <select id="rules-kind-filter">
                    <option value="">All</option>
                    <option value="must_do">must_do</option>
                    <option value="must_not_do">must_not_do</option>
                    <option value="should_do">should_do</option>
                    <option value="ideal">ideal</option>
                  </select>
                </label>
                <label class="grow">
                  Domain filter (comma‑separated):
                  <input
                    id="rules-domain-filter"
                    type="text"
                    placeholder="worship, diet, penance"
                  />
                </label>
              </div>
              <div id="rules-table-wrapper" class="table-wrapper"></div>
            </section>

            <!-- Authority -->
            <section id="movement-subtab-authority" class="subtab-panel">
              <div class="section-heading">Sources of truth</div>
              <div id="authority-sources" class="card-grid"></div>

              <div class="section-heading">Authority entities</div>
              <div id="authority-entities" class="card-grid"></div>
            </section>

            <!-- Media -->
            <section id="movement-subtab-media" class="subtab-panel">
              <div class="subtab-toolbar">
                <label>
                  Entity:
                  <select id="media-entity-filter">
                    <option value="">Any</option>
                  </select>
                </label>
                <label>
                  Practice:
                  <select id="media-practice-filter">
                    <option value="">Any</option>
                  </select>
                </label>
                <label>
                  Event:
                  <select id="media-event-filter">
                    <option value="">Any</option>
                  </select>
                </label>
                <label>
                  Text:
                  <select id="media-text-filter">
                    <option value="">Any</option>
                  </select>
                </label>
              </div>
              <div id="media-gallery" class="card-grid"></div>
            </section>

            <!-- Relations -->
            <section id="movement-subtab-relations" class="subtab-panel">
              <div class="subtab-toolbar">
                <label>
                  Relation type:
                  <select id="relations-type-filter">
                    <option value="">All</option>
                  </select>
                </label>
                <label>
                  Entity:
                  <select id="relations-entity-filter">
                    <option value="">Any</option>
                  </select>
                </label>
              </div>
              <div id="relations-table-wrapper" class="table-wrapper"></div>
            </section>

            <!-- Notes -->
            <section id="movement-subtab-notes" class="subtab-panel">
              <div class="subtab-toolbar">
                <label>
                  Target type:
                  <select id="notes-target-type-filter">
                    <option value="">All</option>
                  </select>
                </label>
                <label>
                  Target:
                  <select id="notes-target-id-filter">
                    <option value="">Any</option>
                  </select>
                </label>
              </div>
              <div id="notes-table-wrapper" class="table-wrapper"></div>
            </section>
          </div>
        </div>
      </section>

      <!-- Generic collection editor -->
      <section id="tab-data" class="tab-panel">
        <div class="panel-body">
          <h2>Collections</h2>
          <p class="hint">
            Edit any collection as JSON. For movement‑scoped collections, you can filter by the
            currently selected movement.
          </p>

          <div class="collection-toolbar">
            <label>
              Collection:
              <select id="collection-select">
                <option value="entities">entities</option>
                <option value="practices">practices</option>
                <option value="events">events</option>
                <option value="rules">rules</option>
                <option value="claims">claims</option>
                <option value="textCollections">textCollections</option>
                <option value="texts">texts</option>
                <option value="media">media</option>
                <option value="notes">notes</option>
                <option value="relations">relations</option>
              </select>
            </label>

            <label class="inline">
              <input id="collection-filter-by-movement" type="checkbox" checked />
              Filter by current movement (including shared)
            </label>

            <div class="collection-actions">
              <button id="btn-add-item" type="button">New item</button>
              <button id="btn-delete-item" type="button" class="danger" disabled>
                Delete item
              </button>
            </div>
          </div>

          <div class="split">
            <div class="list-pane">
              <ul id="collection-items" class="item-list"></ul>
            </div>
            <div class="detail-pane">
              <div class="item-detail-grid">
                <section class="preview-pane">
                  <div class="preview-header">
                    <div>
                      <div class="eyebrow">Human-readable view</div>
                      <h3 id="item-preview-title">Select an item</h3>
                      <div id="item-preview-subtitle" class="muted"></div>
                    </div>
                    <div class="preview-meta">
                      <div class="preview-nav">
                        <button id="btn-preview-back" type="button" title="Back" disabled>
                          ←
                        </button>
                        <button
                          id="btn-preview-forward"
                          type="button"
                          title="Forward"
                          disabled
                        >
                          →
                        </button>
                      </div>
                      <div class="badge" id="item-preview-collection">—</div>
                    </div>
                  </div>
                  <div id="item-preview-body" class="preview-body"></div>
                </section>

                <section class="editor-pane">
                  <div class="preview-header">
                    <div>
                      <div class="eyebrow">Raw JSON</div>
                      <h3>Machine view</h3>
                      <div class="muted">Edit and save changes</div>
                    </div>
                  </div>
                  <textarea
                    id="item-editor"
                    rows="20"
                    spellcheck="false"
                    placeholder="{ ... }"
                  ></textarea>
                  <div class="editor-actions">
                    <button id="btn-save-item" type="button">Save item</button>
                  </div>
                </section>
              </div>
            </div>
          </div>
        </div>
      </section>

      <!-- Comparison tab -->
      <section id="tab-comparison" class="tab-panel">
        <div class="panel-body">
          <h2>Comparison</h2>
          <p class="hint">
            Pick movements to compare. The table uses
            <code>buildComparisonViewModel</code> under the hood.
          </p>

          <div id="comparison-selector" class="comparison-selector"></div>
          <div id="comparison-table-wrapper" class="comparison-table-wrapper"></div>
        </div>
      </section>
    </section>
  </main>

  <!-- Domain / view-model layers -->
  <script src="./view-models.js"></script>
  <script src="./sample-data.js"></script>
  <script src="./storage.js"></script>
  <script src="./domain-service.js"></script>
  <script src="./graph-view.js"></script>
  <!-- comparison-services.js is not required for this UI, but harmless to include if you like -->
  <!-- <script src="./comparison-services.js"></script> -->

  <!-- UI layer -->
  <script src="./app.js"></script>
</body>
</html>
